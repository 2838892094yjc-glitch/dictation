# 词库管理功能使用指南

## 功能概述

词库持久化存储功能允许您保存、加载、管理多个单词词库，所有数据自动保存到本地文件，即使关闭应用也不会丢失。

---

## 快速开始

### 1. 启动应用

```bash
cd /Users/yangjingchi/Desktop/自动听写
streamlit run app.py
```

应用启动后会自动加载"默认词库"。

---

## 界面说明

### 词库管理区

```
┌───────────────────────────────────────────────────────────┐
│ 💾 词库管理                                                │
├───────────────────────────────────────────────────────────┤
│ [当前词库: 默认词库 ▼]  [💾 保存词库] [➕ 新建词库] [🗑️ 删除词库] │
└───────────────────────────────────────────────────────────┘
```

---

## 基本操作

### 1. 查看当前词库

- 左上角下拉框显示当前选中的词库名称
- 下方列表显示词库中的所有单词

### 2. 添加单词到词库

#### 方法1：拍照导入

1. 点击"上传单词表照片"
2. 选择包含单词的图片
3. 等待OCR识别
4. 单词自动添加到词库
5. **自动保存**

#### 方法2：手动输入

1. 在"手动输入"文本框中输入单词
2. 格式：`英文 中文`（每行一个）
   ```
   apple 苹果
   banana 香蕉
   computer 电脑
   ```
3. 点击"➕ 添加到词库"
4. **自动保存**

### 3. 编辑词库

#### 选择单词

- 勾选单词前的复选框，用于听写练习

#### 删除单词

- 点击单词右侧的"🗑️"按钮
- 单词会从词库中移除
- **自动保存**

---

## 高级操作

### 1. 创建新词库

**步骤**：
1. 点击"➕ 新建词库"按钮
2. 系统自动创建一个新词库（名称如"词库_1", "词库_2"）
3. 新词库为空，可以开始添加单词

**用途**：
- 按年级分类（如"三年级词库"、"四年级词库"）
- 按主题分类（如"动物类"、"食物类"）
- 按教材分类（如"人教版Unit1"）

### 2. 切换词库

**步骤**：
1. 点击词库下拉框
2. 从列表中选择要切换的词库
3. 系统自动加载该词库的所有单词

**提示**：
- 切换词库不会影响其他词库
- 当前��库的修改会自动保存

### 3. 保存词库

**自动保存**（推荐）：
- ✅ 添加单词后自动保存
- ✅ 删除单词后自动保存
- ✅ 清空词库后自动保存

**手动保存**：
- 点击"💾 保存词库"按钮
- 适用于想要确保数据已保存的场景

### 4. 删除词库

**步骤**：
1. 切换到要删除的词库
2. 点击"🗑️ 删除词库"按钮
3. 词库文件会从磁盘删除
4. 自动切换回默认词库

**注意**：
- ⚠️ **删除操作不可撤销**
- ⚠️ **默认词库无法删除**（受保护）

### 5. 清空词库

**步骤**：
1. 点击"🗑️ 清空词库"按钮
2. 当前词库的��有单词会被删除
3. **自动保存**

**与删除词库的区别**：
- 清空词库：保留词库，删除所有单词
- 删除��库：连同词库一起删除

---

## 实用技巧

### 1. 词库组织建议

**按年级分类**：
```
- 一年级词库
- 二年级词库
- 三年级词库
```

**按主题分类**：
```
- 动物类词库
- 食物类词库
- 颜色类词库
```

**按教材分类**：
```
- 人教版Unit1
- 人教版Unit2
- 牛津版Lesson1
```

### 2. 快速选择单词

使用"选择模式"快速选择要听写的单词：

- **全不选**：取消所有单词的选择
- **全选**：选择所有单词
- **前n个**：选择前几个单词（如前10个）
- **字母A-Z**：选择从A到某字母的单词
- **字母Z-A**：选择从某字母到Z的单词

### 3. 批量导入单词

**方法1**：拍照导入
- 手写或打印单词表
- 拍照上传
- 开启"AI智能纠正拼写"自动修正错误

**方法2**：手动输入
- 从Word/Excel复制单词
- 整理成"英文 中文"格式
- 批量粘贴到输入框

### 4. 备份词库

**手动备份**：
```bash
# 复制整个词库目录
cp -r data/vocabularies data/vocabularies_backup
```

**查看词库文件**：
```bash
# 词库保存在此目录
ls data/vocabularies/
```

**词库文件格式**：JSON（可用文本编辑器打开）
```json
{
  "name": "默认词库",
  "words": [
    {"en": "apple", "cn": "苹果", "checked": false}
  ],
  "created_at": "2026-02-16T22:23:34.700253",
  "updated_at": "2026-02-16T22:23:34.700262"
}
```

---

## 常见问题

### Q1: 我的词库保存在哪里？

**答**：词库保存在 `data/vocabularies/` 目录下，每个词库是一个独立的 JSON 文件。

### Q2: 关闭应用后词库会丢失吗？

**答**：不会。所有词库都保存在本地文件中，重新打开应用会自动加载。

### Q3: 可以创建多少个词库？

**答**：理论上无限制，但建议控制在20个以内，便于管理。

### Q4: 如何重命名词库？

**答**：目前暂不支持直接重命名。临时方案：
1. 创建新词库
2. 将旧词库的单词复制到新词库
3. 删除旧词库

### Q5: 词库文件可以手动编辑吗？

**答**：可以。词库使用JSON格式，可以用任何文本编辑器打开修改。但建议通过应用界面操作，避免格式错误。

### Q6: 如何导出词库给别人？

**答**：直接复制 `data/vocabularies/` 目录下的 JSON 文件，发送给对方放到同样的目录即可。

### Q7: 支持导入Excel词库吗？

**答**：当前版本暂不支持。后续版本会添加Excel导入功能。

### Q8: 删除词库后能恢复吗？

**答**：不能。删除操作会永久删除文件。建议定期备份重要词库。

### Q9: 为什么有时候保存按钮点击没反应？

**答**：可能是词库为空。空词库无法保存，请先添加单词。

### Q10: 词库最多能存多少个单词？

**答**：理论上无限制。建议单个词库控制在500个单词以内，超过建议分拆成多个词库。

---

## 数据安全

### 自动保存机制

系统会在以下情况自动保存词库：

✅ 拍照导入单词后
✅ 手动输入单词后
✅ 删除单词后
✅ 清空词库后

**无需担心数据丢失！**

### 备份建议

1. **定期备份**：每周备份一次 `data/vocabularies/` 目录
2. **重要词库**：在云盘中保存一份副本
3. **版本控制**：使用Git管理词库文件（适合开发者）

---

## 故障排除

### 问题1：词��加载失败

**症状**：选择词库后显示为空或报错

**解决方案**：
1. 检查 `data/vocabularies/` 目录是否存在
2. 检查词库文件是否损坏（用文本编辑器打开）
3. 尝试创建新词库

### 问题2：保存失败

**症状**：点击保存后提示"保存失败"

**解决方案**：
1. 检查目录权限（是否可写）
2. 检查磁盘空间是否充足
3. 检查词库名称是否包含特殊字符

### 问题3：词库文件找不到

**症状**：切换词库时提示"词库不存在"

**解决方案**：
1. 确认文件是否在 `data/vocabularies/` 目录
2. 检查文件扩展名是否为 `.json`
3. 检查文件名是否与词库名称匹配

---

## 进阶使用

### 自定义词库目录

编辑 `app.py`，在初始化时指定目录：

```python
if 'vocab_store' not in st.session_state:
    # 使用自定义目录
    st.session_state.vocab_store = VocabularyStore(base_dir="/your/custom/path")
```

### 批量导入词库

将多个 JSON 文件复制到 `data/vocabularies/` 目录，重启应用即可看到。

### 词库合并

手动编辑 JSON 文件，将多个词库的 `words` 数组合并到一起。

---

## 更新日志

### v3.0 (2026-02-16)

✅ 实现词库持久化存储
✅ 支持多词库管理
✅ 自动保存功能
✅ 词库切换功能
✅ 词库删除功能
✅ 默认词库加载

---

## 反馈与支持

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件
- 在线反馈

---

## 下一步学习

- [任务2: 听写模式切换](./TASK2_DICTATION_MODE.md)
- [任务3: 音频缓存优化](./TASK3_AUDIO_CACHE.md)

---

**祝您学习愉快！📚**
